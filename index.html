<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Us ðŸ©µ</title>

  <style>
    :root{
      --bg: #050612;
      --text: rgba(255,255,255,.94);
      --muted: rgba(255,255,255,.78);

      --paper: #f7f7f5;
      --paper2: #ffffff;
      --ink: rgba(0,0,0,.80);

      --radius: 16px;
      --shadow: 0 16px 45px rgba(0,0,0,.46);
      --shadow2: 0 10px 26px rgba(0,0,0,.30);

      /* dynamic background image */
      --bg-photo: none;
      --bg-photo-opacity: .30;

      /* glow */
      --glow: 0 0 18px rgba(120, 210, 255, .25);
      --glow-strong: 0 0 24px rgba(120, 210, 255, .40);
    }

    *{ box-sizing: border-box; }

    body{
      margin:0;
      min-height: 100vh;
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      overflow-x: hidden;

      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);

      background: var(--bg);
      position: relative;
      isolation: isolate;
    }

    /* Photo background (from your images/videos posters) */
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      z-index: -3;
      background-image: var(--bg-photo);
      background-size: cover;
      background-position: center;
      filter: blur(18px) saturate(1.12) contrast(1.05);
      opacity: var(--bg-photo-opacity);
      transform: scale(1.12);
      transition: opacity .7s ease;
    }

    /* Dark overlay to make text readable */
    body::after{
      content:"";
      position: fixed;
      inset: 0;
      z-index: -2;
      background:
        radial-gradient(900px 520px at 30% 20%, rgba(255,255,255,.08), transparent 60%),
        radial-gradient(1000px 640px at 85% 55%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.72));
      pointer-events:none;
    }

    /* Starfield layer */
    #stars{
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;
      background:
        radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,.75) 50%, transparent 52%),
        radial-gradient(1px 1px at 80% 30%, rgba(255,255,255,.55) 50%, transparent 52%),
        radial-gradient(1px 1px at 40% 70%, rgba(255,255,255,.60) 50%, transparent 52%),
        radial-gradient(1px 1px at 65% 85%, rgba(255,255,255,.50) 50%, transparent 52%),
        radial-gradient(1px 1px at 25% 55%, rgba(255,255,255,.40) 50%, transparent 52%),
        radial-gradient(2px 2px at 55% 25%, rgba(130,220,255,.35) 50%, transparent 52%),
        radial-gradient(2px 2px at 15% 80%, rgba(180,255,230,.25) 50%, transparent 52%);
      opacity: .55;
      animation: drift 26s ease-in-out infinite alternate;
    }
    @keyframes drift{
      from{ transform: translate3d(0,0,0); }
      to{ transform: translate3d(10px,-14px,0); }
    }

    header, main, footer{
      padding-left: max(16px, env(safe-area-inset-left));
      padding-right: max(16px, env(safe-area-inset-right));
    }

    header{
      max-width: 1100px;
      margin: 22px auto 10px;
      display:flex;
      align-items:flex-end;
      justify-content: space-between;
      gap: 14px;
    }

    .title{ display:flex; flex-direction:column; gap: 6px; }

    /* Cutier title + subtle star glow */
    h1{
      margin:0;
      font-size: clamp(30px, 4.4vw, 48px);
      letter-spacing: -0.02em;
      font-weight: 950;
      font-family:
        ui-rounded,
        "SF Pro Rounded",
        "Segoe Print",
        "Bradley Hand",
        "Comic Sans MS",
        system-ui,
        sans-serif;
      text-shadow: var(--glow-strong);
    }

    .subtitle{
      color: rgba(255,255,255,.82);
      font-size: 14px;
      line-height: 1.35;
      max-width: 68ch;
      text-shadow: var(--glow);
    }

    .controls{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
      align-items:center;
    }

    button{
      appearance:none;
      border: none;
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      border-radius: 999px;
      cursor:pointer;
      transition: transform .12s ease, background .2s ease;
      box-shadow: 0 10px 22px rgba(0,0,0,.22);
      font-weight: 700;
      font-size: 13px;
      white-space: nowrap;
      text-shadow: var(--glow);
    }
    button:hover{ transform: translateY(-1px); background: rgba(255,255,255,.14); }
    button:active{ transform: translateY(0px) scale(.98); }

    .toggle{
      display:flex;
      align-items:center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: none;
      background: rgba(255,255,255,.10);
      font-size: 13px;
      color: rgba(255,255,255,.86);
      user-select:none;
      white-space: nowrap;
      text-shadow: var(--glow);
    }
    .toggle input{
      width: 18px; height: 18px;
      accent-color: #7de2ff;
      cursor:pointer;
    }

    main{
      max-width: 1100px;
      margin: 0 auto 26px;
      padding-bottom: 18px;
    }

    .board{
      position: relative;
      width: 100%;
      min-height: 74vh;
      border-radius: 22px;
      background: rgba(0,0,0,.18);
      overflow: hidden;
      padding: 12px;
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    @media (max-width: 520px){
      header{
        align-items: flex-start;
        flex-direction: column;
      }
      .controls{ justify-content: flex-start; }
      .board{ min-height: 76vh; }
    }

    /* Featured 2x2 grid (always visible) */
    .featuredGrid{
      position: relative;
      z-index: 10;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 14px;
      align-items: stretch;
      width: 100%;
      max-width: 980px;
      margin: 0 auto;
      padding: 10px;
    }

    @media (max-width: 520px){
      .featuredGrid{
        gap: 12px;
        padding: 6px;
      }
    }

    .polaroid{
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--paper2), var(--paper));
      box-shadow: var(--shadow);
      padding: 10px 10px 14px;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      transform: rotate(var(--r, 0deg));
      transition: transform .18s ease;
    }

    .polaroid:active{
      transform: rotate(var(--r, 0deg)) scale(.99);
    }

    .mediaSlot{
      width: 100%;
      aspect-ratio: 4 / 3;
      border-radius: 12px;
      overflow: hidden;
      background: #0b0b12;
      box-shadow: var(--shadow2);
    }

    .mediaSlot img,
    .mediaSlot video{
      width:100%;
      height:100%;
      object-fit: cover;
      object-position: center;
      display:block;
    }

    .caption{
      margin-top: 10px;
      display:flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: var(--ink);
      font-weight: 900;
      letter-spacing: .01em;
      font-family: ui-rounded, "Segoe Print", "Bradley Hand", system-ui, sans-serif;
    }

    .pill{
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.10);
      border: 1px solid rgba(0,0,0,.10);
      font-size: 10px;
      font-weight: 900;
      letter-spacing: .09em;
      text-transform: uppercase;
      color: rgba(0,0,0,.62);
      white-space: nowrap;
    }

    /* Fullscreen viewer (click-to-enlarge) */
    .viewer{
      position: fixed;
      inset: 0;
      z-index: 999;
      display: none;
      align-items: center;
      justify-content: center;
      padding: max(16px, env(safe-area-inset-top)) max(16px, env(safe-area-inset-right))
               max(16px, env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .viewer.open{ display: flex; }

    .viewerCard{
      width: min(980px, 96vw);
      height: min(86vh, 760px);
      border-radius: 18px;
      background: rgba(10,12,20,.55);
      box-shadow: 0 22px 80px rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.10);
      overflow: hidden;
      position: relative;
    }

    .viewerMedia{
      width: 100%;
      height: 100%;
      display: grid;
      place-items: center;
      background: rgba(0,0,0,.35);
    }

    .viewerMedia img,
    .viewerMedia video{
      width: 100%;
      height: 100%;
      object-fit: contain;  /* maximize viewing without cropping */
      background: rgba(0,0,0,.25);
    }

    .viewerHint{
      position:absolute;
      top: 10px;
      left: 10px;
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 800;
      color: rgba(255,255,255,.92);
      background: rgba(0,0,0,.40);
      border: 1px solid rgba(255,255,255,.12);
      text-shadow: var(--glow);
      user-select:none;
    }

    footer{
      max-width: 1100px;
      margin: 10px auto 24px;
      color: rgba(255,255,255,.60);
      font-size: 12px;
      display:flex;
      justify-content: space-between;
      gap: 14px;
      flex-wrap: wrap;
      text-shadow: var(--glow);
    }
  </style>
</head>

<body>
  <div id="stars" aria-hidden="true"></div>

  <header>
    <div class="title">
      <h1>Us ðŸ©µ</h1>
      <div class="subtitle">
        Top row: 2 photos. Bottom row: 2 videos (playing). Oldest â†’ newest timeline.
        When Auto is OFF, tap a card to enlarge it.
      </div>
    </div>

    <div class="controls">
      <button id="shuffleBtn">Advance</button>
      <button id="refreshBtn">Restart</button>
      <label class="toggle" title="Auto advance every few seconds">
        <input id="autoToggle" type="checkbox" checked />
        Auto
      </label>
    </div>
  </header>

  <main>
    <section class="board" id="board">
      <div class="featuredGrid" id="featured"></div>
    </section>
  </main>

  <footer>
    <div>Made with ðŸ©µ â€” hosted on GitHub Pages.</div>
    <div id="status">Loadingâ€¦</div>
  </footer>

  <!-- Fullscreen viewer -->
  <div class="viewer" id="viewer" aria-hidden="true">
    <div class="viewerCard" id="viewerCard">
      <div class="viewerHint">Tap again to close</div>
      <div class="viewerMedia" id="viewerMedia"></div>
    </div>
  </div>

<script>
  // =========================
  // YOUR MEDIA LIST
  // =========================
  // Paste your current array here (photos + videos). Keep it exactly as-is.
  const mediaItems = [
    /* PASTE YOUR LIST HERE */
  ];

  // =========================
  // SETTINGS
  // =========================
  const AUTO_MS = 11000;       // pace
  const TIMELINE_MODE = "asc"; // oldest -> newest
  let cursor = 0;

  const featured = document.getElementById("featured");
  const statusEl = document.getElementById("status");
  const shuffleBtn = document.getElementById("shuffleBtn");
  const refreshBtn = document.getElementById("refreshBtn");
  const autoToggle = document.getElementById("autoToggle");

  const viewer = document.getElementById("viewer");
  const viewerMedia = document.getElementById("viewerMedia");

  let autoTimer = null;
  let viewerOpen = false;

  // =========================
  // DATE NORMALIZATION + SORT
  // =========================
  function normalizeDate(dateStr){
    if(/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) return dateStr;
    const m = /^(\d{4})-(\d{1,2})-(\d{1,2})$/.exec(dateStr);
    if(!m) return dateStr;
    const y = m[1];
    const mm = String(parseInt(m[2], 10)).padStart(2, "0");
    const dd = String(parseInt(m[3], 10)).padStart(2, "0");
    return `${y}-${mm}-${dd}`;
  }

  function dateKey(dateStr){
    const d = normalizeDate(dateStr);
    if(!/^\d{4}-\d{2}-\d{2}$/.test(d)) return Number.POSITIVE_INFINITY;
    const [y,m,dd] = d.split("-").map(Number);
    return new Date(y, m-1, dd).getTime();
  }

  function formatDateLabel(dateStr){
    const d = normalizeDate(dateStr);
    if(!/^\d{4}-\d{2}-\d{2}$/.test(d)) return dateStr;
    const [y,m,dd] = d.split("-").map(Number);
    const dt = new Date(y, m-1, dd);
    return dt.toLocaleDateString(undefined, { year:"numeric", month:"short", day:"2-digit" });
  }

  // Sort once at load (strict oldest -> newest)
  let sortedItems = [...mediaItems].sort((a,b) => dateKey(a.date) - dateKey(b.date));
  if(TIMELINE_MODE === "desc") sortedItems.reverse();

  const sortedPhotos = sortedItems.filter(x => x.kind === "image");
  const sortedVideos = sortedItems.filter(x => x.kind === "video");

  // =========================
  // BACKGROUND PHOTO CYCLING (uses current featured items)
  // =========================
  function setBackgroundFromItem(item){
    const src = (item.poster || item.src);
    document.documentElement.style.setProperty("--bg-photo", `url("${src}")`);
  }

  // =========================
  // FEATURED SELECTION (Oldest -> Newest)
  // Next 2 photos + next 2 videos as we move forward
  // =========================
  function getNextFeaturedSet(){
    const len = sortedItems.length;
    let idx = cursor;
    let steps = 0;

    const photos = [];
    const videos = [];

    while((photos.length < 2 || videos.length < 2) && steps < len * 2){
      const item = sortedItems[idx % len];
      if(item.kind === "image" && photos.length < 2) photos.push(item);
      if(item.kind === "video" && videos.length < 2) videos.push(item);
      idx++;
      steps++;
    }

    while(photos.length < 2 && sortedPhotos.length) photos.push(sortedPhotos[photos.length % sortedPhotos.length]);
    while(videos.length < 2 && sortedVideos.length) videos.push(sortedVideos[videos.length % sortedVideos.length]);

    cursor = idx % len;
    return { photos, videos };
  }

  // =========================
  // VIEWER (tap to enlarge when Auto is OFF)
  // =========================
  function openViewer(item){
    viewerMedia.innerHTML = "";

    if(item.kind === "video"){
      const v = document.createElement("video");
      v.controls = true;
      v.playsInline = true;
      v.preload = "metadata";
      if(item.poster) v.poster = item.poster;

      const source = document.createElement("source");
      source.src = item.src;
      const ext = item.src.split(".").pop().toLowerCase();
      source.type = (ext === "mp4") ? "video/mp4" : "video/quicktime";
      v.appendChild(source);

      viewerMedia.appendChild(v);

      // try to start (muted autoplay isn't necessary since user tapped)
      v.play().catch(()=>{});
    } else {
      const img = document.createElement("img");
      img.alt = "Photo";
      img.src = item.src;
      viewerMedia.appendChild(img);
    }

    viewer.classList.add("open");
    viewer.setAttribute("aria-hidden", "false");
    viewerOpen = true;
  }

  function closeViewer(){
    viewer.classList.remove("open");
    viewer.setAttribute("aria-hidden", "true");
    viewerMedia.innerHTML = "";
    viewerOpen = false;
  }

  // click outside card closes too
  viewer.addEventListener("click", (e) => {
    if(e.target === viewer) closeViewer();
  });

  // =========================
  // RENDERING
  // =========================
  function clearFeatured(){
    featured.innerHTML = "";
  }

  function createPolaroidCard(item, isVideo){
    const card = document.createElement("div");
    card.className = "polaroid";
    card.style.setProperty("--r", `${(Math.random()*8 - 4).toFixed(2)}deg`);

    const mediaSlot = document.createElement("div");
    mediaSlot.className = "mediaSlot";

    const caption = document.createElement("div");
    caption.className = "caption";

    const dateEl = document.createElement("div");
    dateEl.textContent = formatDateLabel(item.date);

    const pill = document.createElement("div");
    pill.className = "pill";
    pill.textContent = isVideo ? "LIVE" : "";

    caption.appendChild(dateEl);
    caption.appendChild(pill);

    card.appendChild(mediaSlot);
    card.appendChild(caption);

    if(isVideo){
      const v = document.createElement("video");
      v.autoplay = true;
      v.loop = true;
      v.muted = true;
      v.playsInline = true;
      v.preload = "metadata";
      if(item.poster) v.poster = item.poster;

      const source = document.createElement("source");
      source.src = item.src;
      const ext = item.src.split(".").pop().toLowerCase();
      source.type = (ext === "mp4") ? "video/mp4" : "video/quicktime";
      v.appendChild(source);

      mediaSlot.appendChild(v);
      setTimeout(() => v.play().catch(()=>{}), 80);
    } else {
      const img = document.createElement("img");
      img.loading = "lazy";
      img.decoding = "async";
      img.alt = "Photo";
      img.src = item.src;
      mediaSlot.appendChild(img);
    }

    // âœ… Only allow enlarge when Auto is OFF
    card.addEventListener("click", () => {
      if(autoToggle.checked) return; // must be unchecked
      if(viewerOpen) closeViewer();
      else openViewer(item);
    });

    return card;
  }

  function renderFeatured(set){
    clearFeatured();

    // choose background from the newest card in the 4-pack (nice â€œprogressionâ€ feel)
    setBackgroundFromItem(set.videos[1] || set.photos[1] || set.photos[0] || set.videos[0]);

    // Top row: 2 photos (fully visible)
    featured.appendChild(createPolaroidCard(set.photos[0], false));
    featured.appendChild(createPolaroidCard(set.photos[1], false));

    // Bottom row: 2 videos (always visible + playing)
    featured.appendChild(createPolaroidCard(set.videos[0], true));
    featured.appendChild(createPolaroidCard(set.videos[1], true));

    statusEl.textContent = `Oldest â†’ newest â€¢ 2 photos + 2 videos`;
  }

  // =========================
  // CONTROLS
  // =========================
  function build(){
    cursor = 0; // restart timeline from oldest
    closeViewer();
    renderFeatured(getNextFeaturedSet());
  }

  function advance(){
    closeViewer();
    renderFeatured(getNextFeaturedSet());
  }

  function startAuto(){
    stopAuto();
    autoTimer = setInterval(advance, AUTO_MS);
  }

  function stopAuto(){
    if(autoTimer) clearInterval(autoTimer);
    autoTimer = null;
  }

  shuffleBtn.addEventListener("click", advance);
  refreshBtn.addEventListener("click", build);

  autoToggle.addEventListener("change", (e) => {
    // If turning Auto ON, close viewer
    if(e.target.checked){
      closeViewer();
      startAuto();
    } else {
      stopAuto();
    }
  });

  // boot
  build();
  startAuto();
</script>
</body>
</html>
